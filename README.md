<div align="center">

# `static-tree`

[![MIT][license.badge]][license] [![github.actions.changeset.badge]][github.actions.changeset] [![npm.badge]][npm] [![bundlephobia.badge]][bundlephobia] [![codecov.badge]][codecov]

</div>

## Table of Contents

- [`static-tree`](#static-tree)
  - [Table of Contents](#table-of-contents)
  - [Installation](#installation)
  - [Quick Start](#quick-start)
  - [Documentation & Terminologies](#documentation--terminologies)
  - [Original Use Case](#original-use-case)
  - [Contributing](#contributing)

## Installation

```bash
npm install static-tree
```

```bash
yarn add static-tree
```

```bash
pnpm add static-tree
```

## Quick Start

1. Use the idiomatic `tBuild` to create a static tree. See [tBuild][api.tBuild] for examples and options.

    ```typescript
    import { tBuild } from 'static-tree';

    const { node: root } = tBuild({ // you can rename node here to whatever
      key: 'root',
      build: (builder) => builder
        .addData({ some: 'data' })
        .addChild('leaf')
        .addChild({
          key: 'nestedChild',
          build: (builder) => builder
            .addData({ nestedChildData: 101 })
            .addChild({
              key: 'grandChild',
              build: (builder) => builder.addChild('grandGrandChild'),
            }),
        })
        .addChild({
          key: 'anotherNestedChild',
          build: (builder) => builder.addChild('grandChild'),
        })
    });
    ```

    The declaration above will produce this tree structure:

    ```tree
    root
      |
      |-- leaf
      |
      |-- nestedChild
      .     |
      .     |-- grandChild
      .             |
      .             |-- grandGrandChild
      |-- anotherNestedChild
            |
            |-- grandChild
    ```

2. Access type-safe nested children

    ```typescript
    root.nestedChild.grandChild.grandGrandChild.$.path({ separator: '.' });
    // -> 'root.nestedChild.grandChild.grandGrandChild'

    root.nestedChild.leaf.$.depth(); // -> 3
    root.nestedChild.anotherNestedChild.grandChild.$.root() // -> point back to root node
    ```

    > the `$` getter returns the [TNodePublicApi][api.TNodePublicApi] collection of methods.

3. Access type-safe `data`

    ```typescript
    root.$.data(); // -> { some: 'data' }
    root.nestedChild.$.data().nestedChildData; // -> 101
    ```

## Documentation & Terminologies

This repo includes a [full api extracted documentation][api] generated by [@microsoft/api-extractor] & [@microsoft/api-documenter]. Please refer to said docs for examples and details.

| Terminology | Description |
| --- | --- |
| static tree | a tree whose nodes are declared in one operation and are not likely to change at runtime |
| [TNode][api.TNode] | a node of the static tree with optional inner [TNodeData][api.TNodeData], optional parent, and zero or more children |
| [ExtendedTNode][api.ExtendedTNode] | a [TNode][api.TNode] with children inline as properties for better DX |
| [ExtendedTNodeBuilder][api.ExtendedTNodeBuilder] | type-safe builder for [ExtendedTNode][api.ExtendedTNode] |
| [tBuild][api.tbuild] | functional wrapper for [ExtendedTNodeBuilder][api.ExtendedTNodeBuilder] |

## Original Use Case

This package was derived from the solution to a specific problem I encountered frequently. Consider having this "config" object:

```typescript
const AppConfig = {
  urls: {
    web: 'https://domain.example',
    api: {
      index: 'https://api.domain.example',
      auth: {
        index: '/auth',
        logout: '/logout',
        oauth: {
          index: '/oauth',
          google: '/google',
          // ...
        },
      },
    },
  },
};
```

To get a full api url of google oauth, we have to do quite a lot:

```typescript
const { api: { auth, index } } = AppConfig.urls;
const path = index + auth.index + auth.index.oauth.index + auth.oauth.google;
```

Already there are some problems:

- Verbosity: lots of reference to get to something, more typing equals more typos equals less productive time.
- The inconsistency of the config structure: some path will require an object `index`, some path is just a string. We could refactor to something more predictable, although i think we can agree that this would quickly get out of hand and is very disorienting to look at:

    ```typescript
    const AppConfig = {
      urls: {
        web: {
          base: 'https://domain.example',
          paths: {},
        },
        api: {
          base: 'https://api.domain.example',
          paths: {
            auth: {
              base: '/auth',
              paths: {
                logout: {
                  base: '/logout',
                },
                // ...
              },
            },
          },
        },
      },
    };
    ```

Introducing `static-tree`, arguably a better alternative to the above.

```typescript
import { tBuild } from 'static-tree';

const { node: api } = tBuild({
  key: 'api',
  pathResolver: () => 'https://api.domain.example',
  build: (builder) => builder
    .addChild({
      key: 'auth',
      build: (builder) => builder
        .addChild('logout')
        .addChild({
          key: 'oauth',
          build: (builder) => builder
            .addChild('google')
            .addChild('discord'),
            //...
        }),
    }),
});
```

You might say, why the ugly builder pattern? Because I have not figured out any other pattern that allows the same level of type-safety. It seems like a lot for what would be an object declaration, but consider what we can do now:

```typescript
api.auth.oauth.google.$.path(); // -> 'https://api.domain.example/auth/oauth/google'
```

Even more cool things (and perhaps more in the future if we need to extend the api):

```typescript
api.auth.oauth.google.$.path({ depth: 2 }); // -> 'oauth/google'
api.auth.oauth.google.$.path({ depth: -2 }); // -> 'https://api.domain.example/auth'
```

## Contributing

[Read Contribution Guide][github.contributing]

<p align="center">
  <a href="https://www.buymeacoffee.com/vnphanquang" target="_blank">
    <img
      src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png"
      height="60"
      width="217"
      alt="buy vnphanquang a coffee"
    />
  </a>
</p>

<!-- github specifics -->
[github.contributing]: ./CONTRIBUTING.md
[api]: ./api/docs/index.md
[api.tBuild]: ./api/docs/static-tree.tbuild.md
[api.TNode]: ./api/docs/static-tree.tnode.md
[api.TNodeData]: ./api/docs/static-tree.tnodedata.md
[api.ExtendedTNode]: ./api/docs/static-tree.extendedtnode.md
[api.ExtendedTNodeBuilder]: ./api/docs/static-tree.extendedtnodebuilder.md
[api.TNodePublicApi]: ./api/docs/static-tree.tnodepublicapi.md

<!-- heading badge -->
[npm.badge]: https://img.shields.io/npm/v/static-tree
[npm]: https://www.npmjs.com/package/static-tree
[bundlephobia.badge]: https://img.shields.io/bundlephobia/minzip/static-tree?label=minzipped
[bundlephobia]: https://bundlephobia.com/package/static-tree
[license.badge]: https://img.shields.io/badge/license-MIT-blue.svg
[license]: ./LICENSE
[github.actions.changeset.badge]: https://github.com/vnphanquang/static-tree/actions/workflows/changeset.yaml/badge.svg
[github.actions.changeset]: https://github.com/vnphanquang/static-tree/actions/workflows/changeset.yaml
[codecov.badge]: https://codecov.io/github/vnphanquang/static-tree/coverage.svg?branch=main
[codecov]: https://codecov.io/github/vnphanquang/static-tree?branch=main
[@microsoft/api-extractor]: https://www.npmjs.com/package/@microsoft/api-extractor
[@microsoft/api-documenter]: https://www.npmjs.com/package/@microsoft/api-documenter
